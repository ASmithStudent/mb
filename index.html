<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <meta name="description" content="Course page for Mission Bit at Gateway HS">
    <meta name="author" content="Greg Gorlen">
    <meta name="keywords" content="mission, bit, gateway">
    <title>Mission Bit at Gateway HS</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">

    <noscript>
      <style>body { display: block; opacity: 1; }</style>
    </noscript>

    <style>

      h1 {
        display: block;
        flex-shrink: 1;  // trying to fix wrapping in ie
        box-sizing: border-box; /* 2 */
        max-width: 100%; /* 1 */
      }

      html, body {
        height: 100%;
      }

      main {  
        flex: 1 0 0;
      }

      footer i {
        margin: 0.4em;
        color: #444;
      }

      footer a, 
      footer a:link,
      footer a:visited,
      footer a:hover,
      footer a:active,
      footer a:focus { 
        border: 0;
        font-size: 1em;
      }

      #wrapper {
       display: flex; flex-direction: column; align-items: center; flex-wrap: wrap; height: 100%;
      }

      @media screen and (max-width: 900px) {
        main {
          flex: 0 1 auto;
        }

        div#wrapper {
          height: 80%;
        }
      }


    </style>

  </head>

  <body>

    <nav>
      <a href="modules/">Modules</a>
      <a href="resources/">Resources</a>
      <a href="projects/">Projects</a>
      <a href="about/">About</a>
    </nav>

    <div id="wrapper">
      <main style="background: transparent; margin: 0;"> 
        <h1 style="color: #444;">Mission Bit at Gateway HS</h1>
      </main>

      <footer>
        <a href="https://www.github.com/ggorlen" title="github"><i class="fa fa-github fa-2x"></i></a>
        <a href="https://www.codepen.io/ggorlen/" title="codepen"><i class="fa fa-codepen fa-2x"></i></a>
      </footer>  
    </div>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js">
    </script>

    <!-- Global JS script -->
    <script src="js/global.js"></script>

    <script>
      "use strict";

      const canvas = document.createElement("canvas");
      canvas.width = parseInt(getComputedStyle(document.body).width);
      canvas.height = parseInt(getComputedStyle(document.body).height);
      document.body.appendChild(canvas);
      canvas.style.position = "absolute";
      canvas.style.top = 0;
      canvas.style.zIndex = -1;
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "#d22";
      ctx.lineWidth = 10;
      let handles = [];
      let handleQty = 17;
      let handleSize = (Math.min(canvas.width, canvas.height) / 20) | 0;
      let friction = 0.8;
      let spring = 0.03;
      let springLength = (Math.min(canvas.width, canvas.height) / handleQty * 3) | 0;
      let mouse = { x: canvas.width / 2, y: canvas.height / 2 };
      let draggingHandle;
      let timeout;

      const Handle = function (x, y, radius) {
        this.x = x;
        this.y = y;
        this.vx = 0;
        this.vy = 0;
        this.radius = radius;
      };

      const springTo = (a, b) => {
        const dx = b.x - a.x;
        const dy = b.y - a.y;
        const angle = Math.atan2(dy, dx);
        const targetX = b.x - Math.cos(angle) * springLength;
        const targetY = b.y - Math.sin(angle) * springLength;

        a.vx += (targetX - a.x) * spring;
        a.vy += (targetY - a.y) * spring;
        a.vx *= friction;
        a.vy *= friction;
        //a.vy += 0.05;
        a.x += a.vx;
        a.y += a.vy;

        //if (a.y <= canvas.height) {
       //   a.y += a.vy;
        //}
       // else {
       //   a.y = canvas.height;
       // }
      };

      const init = () => {
        canvas.width = parseInt(getComputedStyle(document.body).width);
        canvas.height = parseInt(getComputedStyle(document.body).height);
        ctx.fillStyle = "#d22";
        ctx.lineWidth = 10;
        handles = [];
        handleQty = 17;
        handleSize = (Math.min(canvas.width, canvas.height) / 20) | 0;
        friction = 0.4;
        spring = 0.13;
        springLength = (Math.min(canvas.width, canvas.height) / handleQty * 4) | 0;
        mouse = { x: canvas.width / 2, y: canvas.height / 2 };
        draggingHandle = null;

        for (let i = 0; i < handleQty; i++) {
          handles.push(new Handle(
            Math.random() * canvas.width, 
            Math.random() * canvas.height, 
            handleSize
          ));
        }
      };

      const orientation = (p, q, r) => {
        const val = (q.y - p.y) * (r.x - q.x) - 
                    (q.x - p.x) * (r.y - q.y);
        return val === 0 ? 0 : ((val > 0) ? 1 : 2);
      };
      
      const jarvis = points => {
        const hull = [];
        const leftMost = points.reduce((a, e, i) => points[a].x < points[i].x ? a : i, 0);
        let q = 0;
        let p = leftMost;
        let endpoint;
        
        do {
          hull.push(points[p]);
          q = (p + 1) % points.length;
          
          for (let i = 0; i < points.length; i++) {
             const o = orientation(points[p], points[i], points[q]);
            
             if (o === 2) {
               q = i;
             }
          }
          
          p = q;
        } while (p !== leftMost);
        return hull;
      };

      window.addEventListener("resize", e => {
        clearTimeout(timeout);
        timeout = setTimeout(init, 500);
      });
      document.addEventListener("mousedown", e => {
        for (let i = 0; i < handles.length; i++) {
          if ((mouse.x - handles[i].x) * (mouse.x - handles[i].x) + 
              (mouse.y - handles[i].y) * (mouse.y - handles[i].y) <= 
               handles[i].radius * handles[i].radius) {
             e.preventDefault();
             draggingHandle = handles[i];
             break;
          }
        }
      });
      document.addEventListener("mouseup", e => setTimeout(e => draggingHandle = null, 500)); 
      document.addEventListener("mousemove", e => {
        mouse.x = e.pageX;
        mouse.y = e.pageY;
        
        if (draggingHandle) {
          draggingHandle.x = mouse.x;
          draggingHandle.y = mouse.y;
        }
      });

      init();


      (function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // ctx.globalCompositeOperation = "source-over";
        // ctx.fillStyle = "rgba(255, 255, 255, 0.2)";
        // ctx.fillRect(0, 0, canvas.width, canvas.height);
  
        //ctx.shadowBlur = 5;
        //ctx.shadowColor = "#999";

        for (let i = 0; i < handles.length; i++) {
          if (handles[i] !== draggingHandle) {
            for (let j = 0; j < handles.length; j++) {
              if (i !== j) {
                springTo(handles[i], handles[j]);
              }
            }
          }
        }

        ctx.fillStyle = "#333";
        handles.forEach(e => {
          ctx.beginPath();
          ctx.arc(e.x, e.y, 2, 0, Math.PI * 2);
          ctx.fill(); 
        });

        ctx.fillStyle = "#d55";
        ctx.beginPath();
        jarvis(handles).forEach(e => ctx.lineTo(e.x, e.y));
        ctx.closePath();
        ctx.fill();

        requestAnimationFrame(update);
      })();
    </script>
  </body>
</html>
